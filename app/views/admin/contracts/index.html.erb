<% content_for :title, "Gestionar Contratos - Admin" %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <%# Header %>
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-4xl font-bold text-gray-900">Gestionar Contratos</h1>
      <p class="mt-2 text-gray-600">Gestiona códigos QR y documentos de contratos</p>
    </div>
  </div>

  <%# Search and Filters %>
  <div class="mb-8">
    <%= form_with url: admin_contracts_path, method: :get, local: true, class: "flex gap-4" do |f| %>
      <%= f.text_field :search, placeholder: "Buscar por número de contrato...", value: params[:search], class: "flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#125282] focus:border-transparent" %>
      <%= f.submit "Buscar", class: "px-6 py-2 bg-[#125282] text-white rounded-lg hover:bg-[#0f4670] transition-colors" %>
      <% if params[:search].present? %>
        <%= link_to "Limpiar", admin_contracts_path, class: "px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors" %>
      <% end %>
    <% end %>
  </div>

  <%# Contracts Table %>
  <div class="bg-white shadow-lg rounded-lg overflow-hidden">
    <table class="w-full">
      <thead class="bg-gray-100 border-b-2 border-gray-300">
        <tr>
          <th class="px-6 py-4 text-left text-sm font-bold text-gray-700">Contrato</th>
          <th class="px-6 py-4 text-left text-sm font-bold text-gray-700">Cliente</th>
          <th class="px-6 py-4 text-left text-sm font-bold text-gray-700">Préstamo</th>
          <th class="px-6 py-4 text-left text-sm font-bold text-gray-700">Código QR</th>
          <th class="px-6 py-4 text-left text-sm font-bold text-gray-700">Firmado</th>
          <th class="px-6 py-4 text-right text-sm font-bold text-gray-700">Acciones</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        <% @contracts.each do |contract| %>
          <tr class="hover:bg-gray-50 transition-colors">
            <td class="px-6 py-4">
              <span class="font-medium text-[#125282]"><%= contract.id %></span>
            </td>
            <td class="px-6 py-4">
              <% if contract.loan&.customer %>
                <p class="font-medium text-gray-900"><%= contract.loan.customer.full_name %></p>
                <p class="text-sm text-gray-600"><%= contract.loan.customer.identification_number %></p>
              <% else %>
                <span class="text-gray-500">Sin cliente</span>
              <% end %>
            </td>
            <td class="px-6 py-4">
              <% if contract.loan %>
                <p class="font-medium text-gray-900"><%= contract.loan.contract_number %></p>
                <p class="text-sm text-gray-600"><%= contract.loan.status %></p>
              <% else %>
                <span class="text-gray-500">Sin préstamo</span>
              <% end %>
            </td>
            <td class="px-6 py-4 text-center">
              <% if contract.qr_code_present? %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                  ✓ Cargado
                </span>
              <% else %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                  ⚠ Pendiente
                </span>
              <% end %>
            </td>
            <td class="px-6 py-4 text-center">
              <% if contract.signed? %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                  Sí
                </span>
              <% else %>
                <span class="text-gray-500">No</span>
              <% end %>
            </td>
            <td class="px-6 py-4 text-right">
              <%= link_to "Ver", admin_contract_path(contract), class: "text-[#125282] hover:text-[#0f4670] font-medium mr-4" %>
              <%= link_to "Editar", edit_admin_contract_path(contract), class: "text-indigo-600 hover:text-indigo-900 font-medium" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <%# Pagination %>
  <% if @contracts.respond_to?(:total_pages) %>
    <div class="mt-8 flex justify-center">
      <%= paginate @contracts %>
    </div>
  <% end %>
</div>
