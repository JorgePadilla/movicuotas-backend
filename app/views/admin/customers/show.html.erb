<% content_for :title, "Detalles del Cliente - Admin - MOVICUOTAS" %>

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Page header -->
  <div class="mb-8 flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold text-[#125282]"><%= @customer.full_name %></h1>
      <p class="text-gray-600 mt-2"><%= @customer.identification_number %></p>
    </div>
    <div>
      <%= link_to "Editar", edit_admin_customer_path(@customer), class: "bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors" %>
    </div>
  </div>

  <!-- Customer details -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <!-- Personal Info -->
    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-6">
      <h2 class="text-xl font-semibold text-[#125282] mb-6">Información Personal</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-600">Nombre Completo</label>
          <p class="text-lg text-gray-900 mt-1"><%= @customer.full_name %></p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-600">Número de Identidad</label>
          <p class="text-lg text-gray-900 mt-1"><%= @customer.identification_number %></p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-600">Género</label>
          <p class="text-lg text-gray-900 mt-1"><%= @customer.gender.titleize %></p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-600">Fecha de Nacimiento</label>
          <p class="text-lg text-gray-900 mt-1">
            <%= @customer.date_of_birth.strftime("%d de %B de %Y") %>
            <span class="text-sm text-gray-600 ml-2">(<%= @customer.age %> años)</span>
          </p>
        </div>
      </div>
    </div>

    <!-- Contact Info -->
    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-6">
      <h2 class="text-xl font-semibold text-[#125282] mb-6">Información de Contacto</h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-600">Teléfono</label>
          <p class="text-lg text-gray-900 mt-1"><%= @customer.phone %></p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-600">Email</label>
          <p class="text-lg text-gray-900 mt-1"><%= @customer.email || "No registrado" %></p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-600">Estado</label>
          <div class="mt-1">
            <span class="px-4 py-2 text-lg rounded-lg font-medium <%= @customer.active? ? 'bg-green-100 text-green-800' : @customer.suspended? ? 'bg-orange-100 text-orange-800' : 'bg-red-100 text-red-800' %>">
              <%= @customer.status.titleize %>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loans section -->
  <div class="bg-white rounded-xl shadow-md border border-gray-200 p-6 mb-8">
    <h2 class="text-xl font-semibold text-[#125282] mb-6">Préstamos</h2>

    <% if @customer.loans.any? %>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Contrato</th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Monto</th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cuotas</th>
              <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Creado</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @customer.loans.order(created_at: :desc).each do |loan| %>
              <tr>
                <td class="px-4 py-3">
                  <span class="font-medium text-[#125282]"><%= loan.contract_number %></span>
                </td>
                <td class="px-4 py-3">
                  L. <%= number_with_delimiter(loan.total_amount, delimiter: ',') %>
                </td>
                <td class="px-4 py-3">
                  <span class="px-2 py-1 text-xs rounded-full <%= loan.active? ? 'bg-green-100 text-green-800' : loan.paid? ? 'bg-blue-100 text-blue-800' : 'bg-red-100 text-red-800' %>">
                    <%= loan.status.titleize %>
                  </span>
                </td>
                <td class="px-4 py-3">
                  <% paid = loan.installments.where(status: 'paid').count %>
                  <% total = loan.installments.count %>
                  <%= "#{paid}/#{total}" %>
                </td>
                <td class="px-4 py-3">
                  <%= loan.created_at.strftime("%d/%m/%Y") %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-gray-500 text-center py-8">Este cliente no tiene préstamos registrados</p>
    <% end %>
  </div>

  <!-- Account activity -->
  <div class="bg-white rounded-xl shadow-md border border-gray-200 p-6 mb-8">
    <h2 class="text-xl font-semibold text-[#125282] mb-6">Historial de Cuenta</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-600">Creado</label>
        <p class="text-lg text-gray-900 mt-1"><%= @customer.created_at.strftime("%d/%m/%Y") %></p>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-600">Última Actualización</label>
        <p class="text-lg text-gray-900 mt-1"><%= @customer.updated_at.strftime("%d/%m/%Y %H:%M") %></p>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-600">Total de Préstamos</label>
        <p class="text-lg text-gray-900 mt-1"><%= @customer.loans.count %></p>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-600">Préstamos Activos</label>
        <p class="text-lg text-gray-900 mt-1"><%= @customer.loans.active.count %></p>
      </div>
    </div>
  </div>

  <!-- Footer navigation -->
  <div class="flex justify-between items-center">
    <div>
      <%= link_to "← Volver a Clientes", admin_customers_path, class: "text-[#125282] hover:underline font-medium" %>
    </div>
    <div>
      <%= link_to "← Volver al Dashboard", admin_dashboard_path, class: "text-[#125282] hover:underline font-medium" %>
    </div>
  </div>
</div>
