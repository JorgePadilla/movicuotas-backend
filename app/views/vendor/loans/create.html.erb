<%# Step 15: Crédito Aplicado (Success Screen) %>
<%# This view is displayed after successful loan finalization %>
<%# Design Requirements: %>
<%# - Large success message in GREEN (#10b981) %>
<%# - Two action buttons: %>
<%#   1. "Descargar Contrato" - border style, secondary %>
<%#   2. "Proceder a Configuración de Teléfono" - primary blue (#125282) %>
<%# - Display contract number %>
<%# - Optional loan summary %>
<%# - "Nueva Búsqueda" link to return to Step 2 %>

<div class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
  <div class="sm:mx-auto sm:w-full sm:max-w-md">
    <%# Success Icon %>
    <div class="flex justify-center">
      <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100">
        <svg class="h-12 w-12 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
      </div>
    </div>

    <%# Success Message %>
    <div class="mt-6 text-center">
      <h1 class="text-4xl font-extrabold" style="color: #10b981;">
        ¡Crédito Aplicado!
      </h1>
      <p class="mt-4 text-xl text-gray-700">
        Felicidades. Estás a unos pasos de disfrutar de nueva compra.
      </p>
    </div>

    <%# Contract Number %>
    <div class="mt-8 bg-white py-6 px-4 shadow rounded-lg">
      <div class="text-center">
        <p class="text-sm font-medium text-gray-500">Número de Contrato</p>
        <p class="mt-2 text-2xl font-bold text-gray-900">
          <%= @loan.contract_number %>
        </p>
      </div>

      <%# Optional Loan Summary %>
      <div class="mt-6 border-t border-gray-200 pt-6">
        <h3 class="text-lg font-medium text-gray-900">Resumen del Crédito</h3>
        <dl class="mt-4 grid grid-cols-2 gap-4">
          <div class="col-span-1">
            <dt class="text-sm font-medium text-gray-500">Cliente</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @loan.customer.full_name %></dd>
          </div>
          <div class="col-span-1">
            <dt class="text-sm font-medium text-gray-500">Monto Total</dt>
            <dd class="mt-1 text-sm text-gray-900">L. <%= number_to_currency(@loan.total_amount, unit: "", delimiter: ",") %></dd>
          </div>
          <div class="col-span-1">
            <dt class="text-sm font-medium text-gray-500">Enganche</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @loan.down_payment_percentage %>% (L. <%= number_to_currency(@loan.down_payment_amount, unit: "", delimiter: ",") %>)</dd>
          </div>
          <div class="col-span-1">
            <dt class="text-sm font-medium text-gray-500">Cuotas</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @loan.number_of_installments %> quincenales</dd>
          </div>
          <div class="col-span-1">
            <dt class="text-sm font-medium text-gray-500">Cuota Quincenal</dt>
            <dd class="mt-1 text-sm text-gray-900">L. <%= number_to_currency(@loan.installments.first&.amount || 0, unit: "", delimiter: ",") %></dd>
          </div>
          <div class="col-span-1">
            <dt class="text-sm font-medium text-gray-500">Dispositivo</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @loan.device.brand %> <%= @loan.device.model %></dd>
          </div>
        </dl>
      </div>
    </div>

    <%# Action Buttons %>
    <div class="mt-8 grid grid-cols-1 gap-4">
      <%# Primary Button: Proceed to Phone Configuration (Step 16) %>
      <%= link_to vendor_mdm_blueprint_path(@loan.device.mdm_blueprint),
                  class: "flex items-center justify-center px-6 py-4 border border-transparent rounded-md shadow-sm text-lg font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2",
                  style: "background-color: #125282;" do %>
        <svg class="h-6 w-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
        </svg>
        Proceder a Configuración de Teléfono
      <% end %>

      <%# Secondary Button: Download Contract %>
      <%= link_to download_contract_vendor_loan_path(@loan),
                  class: "flex items-center justify-center px-6 py-4 border border-gray-300 rounded-md shadow-sm text-lg font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",
                  target: "_blank" do %>
        <svg class="h-6 w-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        Descargar Contrato
      <% end %>
    </div>

    <%# Navigation Links %>
    <div class="mt-8 text-center">
      <p class="text-sm text-gray-600">
        ¿Deseas iniciar una nueva búsqueda?
        <%= link_to "Nueva Búsqueda", vendor_customer_search_path,
                    class: "font-medium text-blue-600 hover:text-blue-500",
                    style: "color: #125282;" %>
      </p>
    </div>

    <%# Progress Indicator (showing completed steps) %>
    <div class="mt-12">
      <h4 class="text-sm font-medium text-gray-500 text-center">Proceso de Venta Completado</h4>
      <div class="mt-4 flex items-center justify-center">
        <div class="flex items-center">
          <% (1..15).each do |step| %>
            <div class="flex items-center">
              <div class="h-3 w-3 rounded-full <%= step <= 15 ? 'bg-green-500' : 'bg-gray-300' %>"></div>
              <% unless step == 15 %>
                <div class="w-8 h-1 <%= step <= 14 ? 'bg-green-500' : 'bg-gray-300' %>"></div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
      <p class="mt-2 text-xs text-gray-500 text-center">Paso 15 de 18 completado</p>
    </div>
  </div>
</div>