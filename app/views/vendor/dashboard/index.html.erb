<% content_for :title, "Dashboard - Supervisor" %>

<div class="max-w-7xl mx-auto px-2 sm:px-3 lg:px-4 py-4">
  <!-- Page header -->
  <div class="mb-6 md:mb-8">
    <h1 class="text-2xl md:text-3xl font-bold text-[#125282]">Dashboard de Supervisor</h1>
    <p class="text-gray-600 mt-1 md:mt-2 text-sm md:text-base">Resumen de tus actividades y estadÃ­sticas</p>
  </div>

  <!-- Quick actions -->
  <div class="mb-6 md:mb-8 grid grid-cols-1 sm:grid-cols-3 gap-4 md:gap-6">
    <%= link_to "Nueva BÃºsqueda", vendor_customer_search_path, class: "bg-[#125282] hover:bg-[#0f4670] text-white px-4 md:px-6 py-3 rounded-lg font-medium transition-colors text-center" %>
    <%= link_to "Ver PrÃ©stamos", vendor_loans_path, class: "bg-white border border-[#125282] text-[#125282] hover:bg-[#125282] hover:text-white px-4 md:px-6 py-3 rounded-lg font-medium transition-colors text-center" %>
    <%= link_to "Ver Pagos", vendor_payments_path, class: "bg-white border border-[#125282] text-[#125282] hover:bg-[#125282] hover:text-white px-4 md:px-6 py-3 rounded-lg font-medium transition-colors text-center" %>
  </div>

  <!-- Metrics grid -->
  <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
    <!-- Customers card -->
    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 md:p-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-3 md:mb-4">
        <h3 class="text-base md:text-lg font-semibold text-[#125282]">ðŸ‘¥ Clientes</h3>
        <div class="text-xl md:text-2xl font-bold text-gray-800"><%= @total_customers %></div>
      </div>
      <div class="space-y-1 md:space-y-2 text-xs md:text-sm">
        <div class="flex justify-between">
          <span class="text-gray-600">Activos</span>
          <span class="font-medium text-green-600"><%= @active_customers %></span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Suspendidos</span>
          <span class="font-medium text-orange-500"><%= @suspended_customers %></span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Bloqueados</span>
          <span class="font-medium text-red-600"><%= @blocked_customers %></span>
        </div>
      </div>
    </div>

    <!-- Devices card -->
    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 md:p-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-3 md:mb-4">
        <h3 class="text-base md:text-lg font-semibold text-[#125282]">ðŸ“± Dispositivos</h3>
        <div class="text-xl md:text-2xl font-bold text-gray-800"><%= @assigned_devices %></div>
      </div>
      <p class="text-gray-600 text-xs md:text-sm">Asignados a prÃ©stamos activos</p>
    </div>

    <!-- Loans card -->
    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 md:p-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-3 md:mb-4">
        <h3 class="text-base md:text-lg font-semibold text-[#125282]">ðŸ’° PrÃ©stamos</h3>
        <div class="text-xl md:text-2xl font-bold text-gray-800"><%= @active_loans %></div>
      </div>
      <div class="space-y-1 md:space-y-2 text-xs md:text-sm">
        <div class="flex justify-between">
          <span class="text-gray-600">Valor total</span>
          <span class="font-medium text-gray-800">L. <%= @total_loan_value %></span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Promedio</span>
          <span class="font-medium text-gray-800">L. <%= @average_loan_amount %></span>
        </div>
      </div>
    </div>

    <!-- Payments card -->
    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 md:p-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-3 md:mb-4">
        <h3 class="text-base md:text-lg font-semibold text-[#125282]">ðŸ’³ Pagos</h3>
        <div class="text-xl md:text-2xl font-bold text-gray-800">L. <%= @payments_this_month %></div>
      </div>
      <div class="space-y-1 md:space-y-2 text-xs md:text-sm">
        <div class="flex justify-between">
          <span class="text-gray-600">En mora</span>
          <span class="font-medium text-red-600"><%= @overdue_installments %></span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-600">Monto mora</span>
          <span class="font-medium text-red-600">L. <%= @overdue_amount %></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Two-column layout for tables -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-8">
    <!-- Recent payments table -->
    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 md:p-6">
      <div class="flex items-center justify-between mb-4 md:mb-6">
        <h3 class="text-lg md:text-xl font-semibold text-[#125282]">Pagos Recientes</h3>
        <%= link_to "Ver todos", vendor_payments_path, class: "text-sm text-[#125282] hover:underline" %>
      </div>
      <% if @recent_payments.any? %>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <tr class="bg-gray-50">
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monto</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">MÃ©todo</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% @recent_payments.each do |payment| %>
                <tr>
                  <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800"><%= payment.payment_date.strftime("%d/%m/%Y") %></td>
                  <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800"><%= payment.loan.customer.full_name %></td>
                  <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">L. <%= number_with_delimiter(payment.amount, delimiter: ',', separator: '.') %></td>
                  <td class="px-4 py-3 whitespace-nowrap text-sm">
                    <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800"><%= payment.payment_method.titleize %></span>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-gray-500 text-center py-8">No hay pagos recientes</p>
      <% end %>
    </div>

    <!-- Upcoming due dates -->
    <div class="bg-white rounded-xl shadow-md border border-gray-200 p-4 md:p-6">
      <div class="flex items-center justify-between mb-4 md:mb-6">
        <h3 class="text-lg md:text-xl font-semibold text-[#125282]">PrÃ³ximos Vencimientos</h3>
        <%= link_to "Ver todos", vendor_loans_path, class: "text-sm text-[#125282] hover:underline" %>
      </div>
      <% if @upcoming_installments.any? %>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead>
              <tr class="bg-gray-50">
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monto</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">DÃ­as</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <% @upcoming_installments.each do |installment| %>
                <% days_until = (installment.due_date - Date.today).to_i %>
                <tr>
                  <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800"><%= installment.loan.customer.full_name %></td>
                  <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800"><%= installment.due_date.strftime("%d/%m/%Y") %></td>
                  <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-800">L. <%= number_with_delimiter(installment.amount, delimiter: ',', separator: '.') %></td>
                  <td class="px-4 py-3 whitespace-nowrap text-sm">
                    <% if days_until <= 3 %>
                      <span class="px-2 py-1 text-xs rounded-full bg-orange-100 text-orange-800">En <%= days_until %> dÃ­as</span>
                    <% else %>
                      <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">En <%= days_until %> dÃ­as</span>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="text-gray-500 text-center py-8">No hay vencimientos prÃ³ximos</p>
      <% end %>
    </div>
  </div>
</div>